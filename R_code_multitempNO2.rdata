#settiamo la wd anche se non serve in realtà perchè l abbiamo fatta prima
setwd("C:/lab_eco/")
#la libreria che utilizziamo è raster quindi la richiamo
library(raster) #in realtà non avendo chiuso R non serviva farlo 
#ora prendiamo dentro tramite la funzione ratser la prima immagine presa da iol che si trova in lab_eco
EN01 <- raster("EN_0001.png") #le do anche un nome più comodo
plot(EN01) # così la visualizzo (è la situa dell'azoto a gennaio)
#procediampo ad importare tutte le immagini 
EN02 <- raster("EN_0002.png")
EN03 <- raster("EN_0003.png")
EN04 <- raster("EN_0004.png")
EN05 <- raster("EN_0005.png")
EN06 <- raster("EN_0006.png")
EN07 <- raster("EN_0007.png")
EN08 <- raster("EN_0008.png")
EN09 <- raster("EN_0009.png")
EN10 <- raster("EN_0010.png")
EN11 <- raster("EN_0011.png")
EN12 <- raster("EN_0012.png")
EN13 <- raster("EN_0013.png")
#potevo fare un ciclo for per fare prima 
list_rast=list()
for(i in 1:length(rlist)){
  r=raster(rlist[[i]])
  list_rast[[i]]=r
}
# oppure un altro metodo studiato ah hoc per R
library(raser)
setwd("~/lab/esa_no2") #si crea una sottocartella con tutte le immagini png
rlist=list.files(pattern=".png", full.names=T) #in pratica racchiude i file che ci interessano in una lista
list_rast=lapply(rlist, raster) #la funzione lapply le importa
#plot della immagine uno e della 13 per vedere confronto
cl <- colorRampPalette(c('red','orange','yellow'))(100) #cambiamo i colori 
plot(EN01, col=cl)
 plot(EN013, col=cl)
par(mfrow=c(1,2))
plot(EN01, col=cl)
plot(EN13, col=cl)
#ora facciamo una differenza tra le due immagini 
difno2 <- EN13 - EN01
cldif <- colorRampPalette(c('blue','black','yellow'))(100) #
plot(difno2, col=cldif)
#facciamo delle statistiche di base
#1 plottiamo tutte le mappe, ho due strade 
#la più lentapar(mfrow=c(4,4))
par(mfrow=c(4,4))
plot(EN01, col=cl)
plot(EN02, col=cl)
plot(EN03, col=cl)
plot(EN04, col=cl)
plot(EN05, col=cl)
plot(EN06, col=cl)
plot(EN07, col=cl)
plot(EN08, col=cl)
plot(EN09, col=cl)
plot(EN10, col=cl)
plot(EN11, col=cl)
plot(EN12, col=cl)
plot(EN13, col=cl)
## 6/05 caricare i dati in una sola tranche
library(raser)
setwd("C:/lab_eco/esa_no2") #ho messo in una sottocartella le 13 immagini 
rlist <- list.files(pattern=".png") #creo una lista di file che sono accomunati dalla dicitura .png
rlist #vedo la lista che ho appena creato (ci sono le 13 immagink)
listafinale <- lapply(rlist, raster) #la funzione lapply opera una funzione su una lista di file( noi appliciamo la funzione ratser)
EN <- stack(listafinale) #la funzione stack imballa le 13 immagini in una sola 
cl <- colorRampPalette(c('red','orange','yellow'))(100) # 
plot(EN, col=cl) #plot della nuova immagine che comprende tutte le 13 precedenti e con una nuova nuance di colori.

##12/05 rifacciamo l'importazione dei dati
library(raster) #richiamiamo la libreria raster
#abbiamo prima spostato tutti i file da importare in una sottocartella della nosta lab_eco
setwd("C:/lab_eco/esa_no2")
rlist <- list.files(pattern=".png") #creaiamo una lista di file che hanno in comune l'estensione .png
rlist #scrivendo il nome che le ho associato vedo i file che sono compresi 
# vedo questa lista infatti:  [1] "EN_0001.png" "EN_0002.png" "EN_0003.png" "EN_0004.png" "EN_0005.png"
 [6] "EN_0006.png" "EN_0007.png" "EN_0008.png" "EN_0009.png" "EN_0010.png"
[11] "EN_0011.png" "EN_0012.png" "EN_0013.png"
#adesso con la funzione raster posso importare le immagini
#lapply applica una funzione ad una lista, in pratica applico raster alla lista che ho appena crreato
listafinale <- lapply(rlist, raster)
listafinale #mi fa vedere le caratteristiche dei 13 file 
#vedo [[1]]
class      : RasterLayer 
band       : 1  (of  3  bands)
dimensions : 432, 768, 331776  (nrow, ncol, ncell)
resolution : 1, 1  (x, y)
extent     : 0, 768, 0, 432  (xmin, xmax, ymin, ymax)
crs        : NA 
source     : C:/lab_eco/esa_no2/EN_0001.png 
names      : EN_0001 
values     : 0, 255  (min, max)
EN <- stack(listafinale) #questa Funzione raggruppa tutte le 13 immagini in una unica 
#facciamo la differenza tra la prima immagine e l'ultima 
difEN <- EN$EN_0013 - EN$EN_0001 #il dollaro lega 
cld <- colorRampPalette(c('blue','white','red'))(100) # 
plot(difEN, col=cld)
cl <- colorRampPalette(c('red','orange','yellow'))(100) #
 plot(EN, col=cl)
boxplot(EN) # mi fa un grafico dove si vede in un certo senso la distribuzione 
boxplot(EN, horizontal=T) #lo metto orrizontale perchè non si capiva bene 
boxplot(EN, horizontal=T,outline=F) #si vede ancora meglio il calo dei valori massimi 
boxplot(EN, horizontal=T,outline=F,axes=T) #aggiungo anche gli assi
boxplot(EN, horizontal=T,outline=F,axes=F)   #vedo comè senza perchè in realtà =T è quello d default
















